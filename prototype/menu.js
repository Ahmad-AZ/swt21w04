const menutree = 
{
	"de_DE":
	{
		"logo":
		{
			dir:"",
			href:"index.html",
			image:"festivalmanager.png",
			text:"FestivalManager"
		},
		"actor":
		{
			dir:"",
			href:"usergroup.html",
			image:"usergroup.png",
			text:"Nutzergruppe"
		},
		"usecase":
		{
			dir:"",
			href:"index.html",
			image:"../actions.png",
			text:"Aktionen"
		},
		"actors":
		{
			"visitor":
			{
				dir:"visitor/",
				href:"index.html",
				image:"visitor.png",
				text:"Besucher"
			},
			"tickets":
			{
				dir:"tickets/",
				href:"index.html",
				image:"tickets.png",
				text:"Tickets"
			},
			"security":
			{
				dir:"security/",
				href:"index.html",
				image:"security.png",
				text:"Security"
			},
			"stage":
			{
				dir:"stage/",
				href:"index.html",
				image:"stage.png",
				text:"Stage"
			},
			"catering":
			{
				dir:"catering/",
				href:"index.html",
				image:"catering.png",
				text:"Catering"
			},
			"conductor":
			{
				dir:"conductor/",
				href:"index.html",
				image:"conductor.png",
				text:"Festival-Leiter"
			},
			"manager":
			{
				dir:"manager/",
				href:"index.html",
				image:"manager.png",
				text:"Manager"
			},
			"agency":
			{
				dir:"agency/",
				href:"index.html",
				image:"agency.png",
				text:"Agentur"
			},
			"developer":
			{
				dir:"developer/",
				href:"index.html",
				image:"developer.png",
				text:"Entwickler"
			}
		},		
		"usecases":
		{
			"visitor":{},
			"tickets":
			{
				"ticketsOffice":
				{
					dir:"tickets/",
					href:"ticketsOffice.html",
					image:"ticketsOffice.png",
					text:"Tickets Office"
				},
				"ticketsBoxOffice":
				{
					dir:"tickets/",
					href:"ticketsBoxOffice.html",
					image:"ticketsBoxOffice.png",
					text:"Tickets Abendkasse"
				},
				"accessControl":
				{
					dir:"tickets/",
					href:"accessControl.html",
					image:"accessControl.png",
					text:"Zugangskontrolle"
				}
			},
			"security":{},
			"stage":{},
			"catering":
			{
				"logInOut":
				{
					dir:"catering/",
					href:"logInOut.html",
					image:"logInOut.png",
					text:"Log In|Out"
				},
				"sale":
				{
					dir:"catering/",
					href:"sale.html",
					image:"sale.png",
					text:"Verkaufen"
				},
			},
			"conductor":
			{
				"stock":
				{
					dir:"conductor/",
					href:"stock.html",
					image:"stock.png",
					text:"Lager"
				},
				"festivalState":
				{
					dir:"conductor/",
					href:"festivalState.html",
					image:"festivalState.png",
					text:"Festival-Status"
				}
			},
			"manager":
			{
				"createFestival":
				{
					dir:"manager/",
					href:"createFestival.html",
					image:"createFestival.png",
					text:"Festival anlegen"
				},
				"manageFestival":
				{
					dir:"manager/",
					href:"manageFestival.html",
					image:"manageFestival.png",
					text:"Festival managen"
				},
				"createLineUp":
				{
					dir:"manager/",
					href:"createLineUp.html",
					image:"createLineUp.png",
					text:"LineUp anlegen"
				},
				"hireStaff":
				{
					dir:"manager/",
					href:"hireStaff.html",
					image:"hireStaff.png",
					text:"Personal einstellen"
				},
				"costList":
				{
					dir:"manager/",
					href:"costList.html",
					image:"costList.png",
					text:"Kostenaufstellung"
				}
			},
			"agency":
			{
				"bands":
				{
					dir:"agency/",
					href:"bands.html",
					image:"bands.png",
					text:"Bands erfassen"
				},
				"locations":
				{
					dir:"agency/",
					href:"locations.html",
					image:"locations.png",
					text:"Locations erfassen"
				},
				"staff":
				{
					dir:"agency/",
					href:"staff.html",
					image:"staff.png",
					text:"Mitarbeiter erfassen"
				},
				"stages":
				{
					dir:"agency/",
					href:"stages.html",
					image:"stages.png",
					text:"B&uuml;hnenmaterial erfassen"
				}
			},
			"developer":
			{
				"datacheck":
				{
					dir:"developer/",
					href:"datacheck.html",
					image:"datacheck_en.png",
					text:"DataCheck"
				}
			}			
		}
	},
	"en_US":
	{
		"logo":
		{
			dir:"",
			href:"index.html",
			image:"festivalmanager.png",
			text:"FestivalManager"
		},
		"actor":
		{
			dir:"",
			href:"usergroup.html",
			image:"usergroup_en.png",
			text:"Usergroup"
		},
		"usecase":
		{
			dir:"",
			href:"index.html",
			image:"../actions_en.png",
			text:"Actions"
		},
		"actors":
		{
			"visitor":
			{
				dir:"visitor/",
				href:"index.html",
				image:"visitor_en.png",
				text:"Visitors"
			},
			"tickets":
			{
				dir:"tickets/",
				href:"index.html",
				image:"tickets.png",
				text:"Tickets"
			},
			"security":
			{
				dir:"security/",
				href:"index.html",
				image:"security.png",
				text:"Security"
			},
			"stage":
			{
				dir:"stage/",
				href:"index.html",
				image:"stage.png",
				text:"Stage"
			},
			"catering":
			{
				dir:"catering/",
				href:"index.html",
				image:"catering.png",
				text:"Catering"
			},
			"conductor":
			{
				dir:"conductor/",
				href:"index.html",
				image:"conductor_en.png",
				text:"Conductor"
			},
			"manager":
			{
				dir:"manager/",
				href:"index.html",
				image:"manager.png",
				text:"Manager"
			},
			"agency":
			{
				dir:"agency/",
				href:"index.html",
				image:"agency_en.png",
				text:"Agency"
			},
			"developer":
			{
				dir:"developer/",
				href:"index.html",
				image:"developer_en.png",
				text:"Developer"
			}

		},
		
		"usecases":
		{
			"visitor":{},
			"tickets":
			{
				"ticketsOffice":
				{
					dir:"tickets/",
					href:"ticketsOffice.html",
					image:"ticketsOffice.png",
					text:"Tickets Office"
				},
				"ticketsBoxOffice":
				{
					dir:"tickets/",
					href:"ticketsBoxOffice.html",
					image:"ticketsBoxOffice_en.png",
					text:"Tickets BoxOffice"
				},
				"accessControl":
				{
					dir:"tickets/",
					href:"accessControl.html",
					image:"accessControl_en.png",
					text:"Access Control"
				}
			},
			"security":{},
			"stage":{},
			"catering":
			{
				"logInOut":
				{
					dir:"catering/",
					href:"logInOut.html",
					image:"logInOut.png",
					text:"Log In|Out"
				},
				"sale":
				{
					dir:"catering/",
					href:"sale.html",
					image:"sale_en.png",
					text:"Sale"
				},
			},
			"conductor":
			{
				"stock":
				{
					dir:"conductor/",
					href:"stock.html",
					image:"stock_en.png",
					text:"Stock"
				},
				"festivalState":
				{
					dir:"conductor/",
					href:"festivalState.html",
					image:"festivalState_en.png",
					text:"Festival-State"
				}
			},
			"manager":
			{
				"createFestival":
				{
					dir:"manager/",
					href:"createFestival.html",
					image:"createFestival_en.png",
					text:"create Festival"
				},
				"manageFestival":
				{
					dir:"manager/",
					href:"manageFestival.html",
					image:"manageFestival_en.png",
					text:"manage Festival"
				},
				"createLineUp":
				{
					dir:"manager/",
					href:"createLineUp.html",
					image:"createLineUp_en.png",
					text:"create LineUp"
				},
				"hireStaff":
				{
					dir:"manager/",
					href:"hireStaff.html",
					image:"hireStaff_en.png",
					text:"hire Staff"
				},
				"costList":
				{
					dir:"manager/",
					href:"costList.html",
					image:"costList_en.png",
					text:"CostList"
				}
			},
			"agency":
			{
				"bands":
				{
					dir:"agency/",
					href:"bands.html",
					image:"bands_en.png",
					text:"Bandlist"
				},
				"locations":
				{
					dir:"agency/",
					href:"locations.html",
					image:"locations_en.png",
					text:"Locationlist"
				},
				"staff":
				{
					dir:"agency/",
					href:"staff.html",
					image:"staff_en.png",
					text:"Stafflist"
				},
				"stages":
				{
					dir:"agency/",
					href:"stages.html",
					image:"stages_en.png",
					text:"Stagelist"
				}
			},
			"developer":
			{
				"datacheck":
				{
					dir:"developer/",
					href:"datacheck.html",
					image:"datacheck_en.png",
					text:"DataCheck"
				}
			}
		}
	}	
}

function getLocale()
{
	if (location.search != "")
	{
		var x = location.search.substr(1).split(";"), y;
		
		for (var i=0; i<x.length; i++)
		{
			 y = x[i].split("=");
			 //alert(y[0]+"="+y[1]);
			 if (y[0] == "locale")
				return y[1];
		}
	}
	return "de_DE";
}

function relDir(directory, elemDirectory)
{
	if (elemDirectory == null)
		return "";
	if ((directory != "") && (elemDirectory == ""))
		return "../";
	if ((directory == "") && (elemDirectory != ""))
		return elemDirectory;	
	if (directory == elemDirectory)
		return "";
	return directory;

}		

function tag(elem, directory)
{
	let dir = relDir(directory, elem.dir);
	let result=
		"<td><a href='"
		+ dir
		+ elem.href
		+ "?locale="+getLocale()
		+"'><img src='"
		+ dir
		+ elem.image
		+ "' alt='"
		+ elem.text
		+ "' />"
		+ "</a></td>";
	//alert("'"+directory+"'\n'"+elem.dir+"'\n"+result);
	return result;
}

function wholeList(menu, directory)
{
	let retValue= "";
	var menu2 = Object.entries(menu);
	let i, length, item, key;

	length = menu2.length;
	for(i=0; i<length; i++)
	{
		key = menu2[i][0];
		item = menu2[i][1];
		//retValue += key+":";
		retValue +=tag(item, directory)+"\n";
	}
	
	return retValue;
}

function flagMenu(directory)
{
	let retValue = "";
	let dir = relDir(directory, "");
	let url = new String(location);
	let pos = url.search("\\x3F");
	url = url.substr(0,pos);
	//let url=dir+'index.html';
	//alert(url);
	
	
	retValue += "<table>";
	retValue += "<tr><td><a href='"+url+"?locale=de_DE'><img src='"+dir+"flags/de.png' alt='deutsch'/></td></tr>";
	retValue += "<tr><td><a href='"+url+"?locale=en_US'><img src='"+dir+"flags/us.png' alt='englisch'/></td></tr>";
	retValue += "</table>";

	return retValue;
}

function menu(actor, usecase)
{
	//alert(actor+","+usecase);
	let retValue = "";
	var menu = menutree[getLocale()]; //hier stellt man die Sprache ein
	let directory =
		(actor==null)
		? "" :
		(actor=="")
			? ""
			: actor+"/";
			
	retValue += "<table><tr>";
	retValue += "<td>"+flagMenu(directory)+"</td>";
	
	retValue += tag(menu.logo, directory);
	retValue += tag(menu.actor, directory);	
	
	if (actor != null)
	{
		retValue +=
			(actor=="")
			? wholeList(menu.actors, directory)
			: tag(menu.actors[actor], directory);
		
		if (actor !="")
		{
			if (menu.usecases[actor] != null)
		    {
				if (Object.entries(menu.usecases[actor]).length > 0)
					retValue += tag(menu.usecase, "");
				retValue +=
					(usecase=="")
					? wholeList(menu.usecases[actor], directory)
					: tag(menu.usecases[actor][usecase], directory);
			}
		}
	}
	retValue += "</tr></table>";
	//alert(retValue);
	return retValue;
}

if (debug) document.writeln("menu data okay+<br />");